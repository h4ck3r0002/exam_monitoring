{% extends 'base.html' %}
{% load static %}
{% block title %} {{exam.title}} {% endblock title %}

{% block content %}

<div class="container p-3">
    <div class="">
        <h2 style="color: #FFBF61;font-size: 28px;">{{ exam.title }}</h2>
        <p>Số lượng câu hỏi: {{counter}}</p>
        <p style="display: flex;align-items: center;justify-content: space-between;"><span style="color: #222;font-weight: 700;font-size: 18px;">Player: {{request.user.username}}</span><span id="countdown" style="display: block;font-size: 18px;font-weight: 700;color: #0D92F4;">15:00</span></p>
        <form method="post" action="{% url 'exam' exam.id %}">
            {% csrf_token %}
            <div class="slider">
                {% for question in exam.question_set.all %}
                    <div class="slide">
                        <p>Câu hỏi: {{ question.question_text }}</p>

                        <input type="hidden" name="question_{{ question.id }}" value="">
                        {% for answer in question.answer_set.all %}
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="radio" name="question_{{ question.id }}" value="{{ answer.id }}">
                                <label class="form-check-label">
                                    {{ answer.answer_text }}
                                </label>
                            </div>
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>
            
            <div class="controls">
                <button type="button" class="btn btn-dark" onclick="prevSlide()">
                    Prev
                </button>
                <button type="button" class="btn btn-primary" onclick="nextSlide()">
                    Next
                </button>
                <button class="btn btn-success" type="submit">Nộp bài</button>
                <button type="button" onclick="window.location.href = '/'" class="btn btn-dark">Trang chủ</button>
            </div>
        </form>
    </div>
    
    <!-- <video style="position: absolute; top: 50px;right: 100px;width: 200px;height: 200px;" id="videoElement" autoplay muted></video> -->

    <script>
        // Countdown timer (15 minutes)
        let timeLeft = 15 * 60; // 15 minutes in seconds
        const countdownElement = document.getElementById("countdown");

        const timerInterval = setInterval(() => {
            let minutes = Math.floor(timeLeft / 60);
            let seconds = timeLeft % 60;
            seconds = seconds < 10 ? '0' + seconds : seconds;
            countdownElement.innerHTML = `${minutes}:${seconds}`;

            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                document.getElementById("examForm").submit(); // Auto-submit the form when time runs out
            }
            timeLeft -= 1;
        }, 1000);

        // // Yêu cầu quyền truy cập camera
        // navigator.mediaDevices.getUserMedia({ video: true })
        //     .then(function(stream) {
        //         var video = document.getElementById('videoElement');
        //         video.srcObject = stream;
    
        //         // Thiết lập WebRTC và gửi video đến server
        //         startStreamingToServer(stream);
        //     })
        //     .catch(function(err) {
        //         console.log("Something went wrong!", err);
        //     });
    
        

        // // Gửi frame đến server mỗi 1 giây
        // function sendFrameToServer(frameData) {
        //     fetch('/monitoring/upload_frame', {
        //         method: 'POST',
        //         headers: {
        //             'Content-Type': 'application/json',
        //         },
        //         body: JSON.stringify({ frame: frameData }),
        //     }).catch(error => console.log("Error:", error));
        // }

        // async function startStream() {
        //     const video = document.createElement('video');
        //     const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        //     video.srcObject = stream;
        //     video.play();

        //     const canvas = document.createElement('canvas');
        //     const context = canvas.getContext('2d');

        //     setInterval(() => {
        //         context.drawImage(video, 0, 0, canvas.width, canvas.height);
        //         const frameData = canvas.toDataURL('image/jpeg');
        //         sendFrameToServer(frameData);
        //     }, 41); // Gửi mỗi giây một frame
        // }

        // startStream();

    </script>
</div>

{% endblock content %}